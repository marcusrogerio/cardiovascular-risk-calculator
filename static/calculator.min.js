function gender(e){e&&$(e).addClass("active").siblings().removeClass("active");return $("#male").hasClass("active")?1:0}function race(e){e&&$(e).addClass("active").siblings().removeClass("active");return $("#black").hasClass("active")?1:0}function male(){return 1==gender()}function female(){return 0==gender()}function black(){return 1==race()}function nonblack(){return 0==race()}function smoker(e){e&&$(e).addClass("active").siblings().removeClass("active");return $("#smoker_yes").hasClass("active")?1:0}function totalchol(){return _useMMOL?$("#totalchol_mmol").val()*1:$("#totalchol_mgdl").val()/38.666666}function hdlchol(){return _useMMOL?$("#hdlchol_mmol").val()*1:$("#hdlchol_mgdl").val()/38.666666}function diabetes(e){e&&$(e).addClass("active").siblings().removeClass("active");return $("#diabetes_yes").hasClass("active")?1:0}function systole(){return $("#sbp").text()*1}function bptreatment(e){e&&!$(e).parent().hasClass("disabled")&&$(e).addClass("active").siblings().removeClass("active");return $("#bptreatment_yes").hasClass("active")?1:0}function adjust(e,t,n){adjustValue(e,$(t).val(),n)}function adjustValue(e,t,n){if("sbp"==e)if(t>120){$("#bptreatment_toggle").removeClass("disabled");$("#bptreatment_hint").hide()}else if(!$("#bptreatment_toggle").hasClass("disabled")){bptreatment($("#bptreatment_no"));$("#bptreatment_toggle").addClass("disabled");$("#bptreatment_hint").show()}$("#"+e).text(t?Math.round(t*10)/10:0);n||CALC()}function toggleBenefit(e){var t=$(e);t.toggleClass("active").siblings().removeClass("active");var n="";if(t.hasClass("active")){var r=t.data("benefit");if(r in _benefit_risks){var i=_benefit_risks[r];"string"==typeof i?n=i:n="<ul><li>"+i.join("</li><li>")+"</li></ul>"}else alert('There is no harm information for the intervention "'+r+'"')}$("#benefit_information").html(n);n&&n.length>0?$("#benefit_information_header").show():$("#benefit_information_header").hide();CALC()}function benefit(e){if(!!e&&e in _benefit){var t=$("#benefit_estimates").find("li").map(function(e,t){var n=$(t);if(n.hasClass("active"))return n.data("benefit")}).get(),n=0;for(var r in _benefit[e]){if(!t.contains(r))continue;if("bp"==r&&systole()<_bp_threshold)continue;var i=_benefit[e][r];if("number"!=typeof i){var s=0,o=null;for(var u in i)if("default"==u)s=i[u];else{var a=window[u];if(!a||"function"!=typeof a)alert("The benefit for "+r+" of type "+u+" is invalid, needs to be a function name");else if(a()){o=i[u];break}}i=null!==o?o:s}if("number"!=typeof i){console.error(i);alert("Not a numerical value for benefit "+r+": "+i)}else i>n&&(n=i)}return n}alert("I cannot currently calculate benefits for this formula: "+(e?e:"not defined"));return 0}function setFormula(e){setFormulaById($(e).data("calc"))}function setFormulaById(e){if(!e)return;_formula_id=e;$("#formula_selector").find("li").removeClass("active").filter(function(e){return $(this).data("calc")==_formula_id}).addClass("active");calculate(e)}function CALC(){calculate(_formula_id)}function BlackFemale(){this.Age=17.1141;this.AgeSquared=0;this.TC=.9396;this.AgexTC=0;this.HDL=-18.9196;this.AgexHDL=4.4748;this.TreatedBP=29.2907;this.AgexTreatedBP=-6.4321;this.UntreatedBP=27.8197;this.AgexUntreatedBP=-6.0873;this.Smoker=.6908;this.AgexSmoker=0;this.Diabetes=.8738;this.BaselineSurvival=.95334;this.OverallMean=86.6081}function BlackMale(){this.Age=2.469;this.AgeSquared=0;this.TC=.302;this.AgexTC=0;this.HDL=-0.307;this.AgexHDL=0;this.TreatedBP=1.916;this.AgexTreatedBP=0;this.UntreatedBP=1.809;this.AgexUntreatedBP=0;this.Smoker=.549;this.AgexSmoker=0;this.Diabetes=.645;this.BaselineSurvival=.89536;this.OverallMean=19.5425}function WhiteFemale(){this.Age=-29.799;this.AgeSquared=4.884;this.TC=13.54;this.AgexTC=-3.114;this.HDL=-13.578;this.AgexHDL=3.149;this.TreatedBP=2.019;this.AgexTreatedBP=0;this.UntreatedBP=1.957;this.AgexUntreatedBP=0;this.Smoker=7.574;this.AgexSmoker=-1.665;this.Diabetes=.661;this.BaselineSurvival=.96652;this.OverallMean=-29.1817}function WhiteMale(){this.Age=12.344;this.AgeSquared=0;this.TC=11.853;this.AgexTC=-2.664;this.HDL=-7.99;this.AgexHDL=1.769;this.TreatedBP=1.797;this.AgexTreatedBP=0;this.UntreatedBP=1.764;this.AgexUntreatedBP=0;this.Smoker=7.837;this.AgexSmoker=-1.795;this.Diabetes=.658;this.BaselineSurvival=.91436;this.OverallMean=61.1816}function calculate(e){var t=$("#overestimate").text()*1,n=benefit(e);$("#benefit").text(n);var r=$("#time").text()*1,i=gender(),s=$("#age").text()*1,o=systole(),u=smoker(),a=totalchol(),f=hdlchol(),l=diabetes(),c=0,h=120,p=0,d=3,v=1.3,m=0,g=0,y=0,b=0;if("cvd"==e){y=t*(1-Math.exp(-Math.exp((Math.log(r)-(18.8144+ -1.2146*(1-i)+ -1.8443*Math.log(s)+0*Math.log(s)*Math.log(s)+.3668*Math.log(s)*(1-i)+0*Math.log(s)*Math.log(s)*(1-i)+ -1.4032*Math.log(o)+ -0.3899*u+ -0.539*Math.log(a/f)+ -0.3036*l+ -0.1697*l*(1-i)+ -0.3362*c+0*c*i))/(Math.exp(.6536)*Math.exp(-0.2402*(18.8144+ -1.2146*(1-i)+ -1.8443*Math.log(s)+0*Math.log(s)*Math.log(s)+.3668*Math.log(s)*(1-i)+0*Math.log(s)*Math.log(s)*(1-i)+ -1.4032*Math.log(o)+ -0.3899*u+ -0.539*Math.log(a/f)+ -0.3036*l+ -0.1697*l*(1-i)+ -0.3362*c+0*c*i))))));b=t*(1-Math.exp(-Math.exp((Math.log(r)-(18.8144+ -1.2146*(1-i)+ -1.8443*Math.log(s)+0*Math.log(s)*Math.log(s)+.3668*Math.log(s)*(1-i)+0*Math.log(s)*Math.log(s)*(1-i)+ -1.4032*Math.log(h)+ -0.3899*p+ -0.539*Math.log(d/v)+ -0.3036*m+ -0.1697*m*(1-i)+ -0.3362*g+0*g*i))/(Math.exp(.6536)*Math.exp(-0.2402*(18.8144+ -1.2146*(1-i)+ -1.8443*Math.log(s)+0*Math.log(s)*Math.log(s)+.3668*Math.log(s)*(1-i)+0*Math.log(s)*Math.log(s)*(1-i)+ -1.4032*Math.log(h)+ -0.3899*p+ -0.539*Math.log(d/v)+ -0.3036*m+ -0.1697*m*(1-i)+ -0.3362*g+0*g*i))))))}else if("chd"==e){y=t*(1-Math.exp(-Math.exp((Math.log(r)-(15.5305+28.4441*(1-i)+ -1.4792*Math.log(s)+0*Math.log(s)*Math.log(s)+ -14.4588*Math.log(s)*(1-i)+1.8515*Math.log(s)*Math.log(s)*(1-i)+ -0.9119*Math.log(o)+ -0.2767*u+ -0.7181*Math.log(a/f)+ -0.1759*l+ -0.1999*l*(1-i)+ -0.5865*c+0*c*i))/(Math.exp(.9145)*Math.exp(-0.2784*(15.5305+28.4441*(1-i)+ -1.4792*Math.log(s)+0*Math.log(s)*Math.log(s)+ -14.4588*Math.log(s)*(1-i)+1.8515*Math.log(s)*Math.log(s)*(1-i)+ -0.9119*Math.log(o)+ -0.2767*u+ -0.7181*Math.log(a/f)+ -0.1759*l+ -0.1999*l*(1-i)+ -0.5865*c+0*c*i))))));b=t*(1-Math.exp(-Math.exp((Math.log(r)-(15.5305+28.4441*(1-i)+ -1.4792*Math.log(s)+0*Math.log(s)*Math.log(s)+ -14.4588*Math.log(s)*(1-i)+1.8515*Math.log(s)*Math.log(s)*(1-i)+ -0.9119*Math.log(h)+ -0.2767*p+ -0.7181*Math.log(d/v)+ -0.1759*m+ -0.1999*m*(1-i)+ -0.5865*g+0*g*i))/(Math.exp(.9145)*Math.exp(-0.2784*(15.5305+28.4441*(1-i)+ -1.4792*Math.log(s)+0*Math.log(s)*Math.log(s)+ -14.4588*Math.log(s)*(1-i)+1.8515*Math.log(s)*Math.log(s)*(1-i)+ -0.9119*Math.log(h)+ -0.2767*p+ -0.7181*Math.log(d/v)+ -0.1759*m+ -0.1999*m*(1-i)+ -0.5865*g+0*g*i))))))}else if("mi"==e){y=t*(1-Math.exp(-Math.exp((Math.log(r)-(11.4712+10.5109*(1-i)+ -0.7965*Math.log(s)+0*Math.log(s)*Math.log(s)+ -5.4216*Math.log(s)*(1-i)+.7101*Math.log(s)*Math.log(s)*(1-i)+ -0.6623*Math.log(o)+ -0.2675*u+ -0.4277*Math.log(a/f)+ -0.1534*l+ -0.1165*l*(1-i)+0*c+ -0.1588*c*i))/(Math.exp(3.4064)*Math.exp(-0.8584*(11.4712+10.5109*(1-i)+ -0.7965*Math.log(s)+0*Math.log(s)*Math.log(s)+ -5.4216*Math.log(s)*(1-i)+.7101*Math.log(s)*Math.log(s)*(1-i)+ -0.6623*Math.log(o)+ -0.2675*u+ -0.4277*Math.log(a/f)+ -0.1534*l+ -0.1165*l*(1-i)+0*c+ -0.1588*c*i))))));b=t*(1-Math.exp(-Math.exp((Math.log(r)-(11.4712+10.5109*(1-i)+ -0.7965*Math.log(s)+0*Math.log(s)*Math.log(s)+ -5.4216*Math.log(s)*(1-i)+.7101*Math.log(s)*Math.log(s)*(1-i)+ -0.6623*Math.log(h)+ -0.2675*p+ -0.4277*Math.log(d/v)+ -0.1534*m+ -0.1165*m*(1-i)+0*g+ -0.1588*g*i))/(Math.exp(3.4064)*Math.exp(-0.8584*(11.4712+10.5109*(1-i)+ -0.7965*Math.log(s)+0*Math.log(s)*Math.log(s)+ -5.4216*Math.log(s)*(1-i)+.7101*Math.log(s)*Math.log(s)*(1-i)+ -0.6623*Math.log(h)+ -0.2675*p+ -0.4277*Math.log(d/v)+ -0.1534*m+ -0.1165*m*(1-i)+0*g+ -0.1588*g*i))))))}else if("stroke"==e){y=t*(1-Math.exp(-Math.exp((Math.log(r)-(26.5116+.2019*(1-i)+ -2.3741*Math.log(s)+0*Math.log(s)*Math.log(s)+0*Math.log(s)*(1-i)+0*Math.log(s)*Math.log(s)*(1-i)+ -2.4643*Math.log(o)+ -0.3914*u+ -0.0229*Math.log(a/f)+ -0.3087*l+ -0.2627*l*(1-i)+ -0.2355*c+0*c*i))/(Math.exp(-0.4312)*Math.exp(0*(26.5116+.2019*(1-i)+ -2.3741*Math.log(s)+0*Math.log(s)*Math.log(s)+0*Math.log(s)*(1-i)+0*Math.log(s)*Math.log(s)*(1-i)+ -2.4643*Math.log(o)+ -0.3914*u+ -0.0229*Math.log(a/f)+ -0.3087*l+ -0.2627*l*(1-i)+ -0.2355*c+0*c*i))))));b=t*(1-Math.exp(-Math.exp((Math.log(r)-(26.5116+.2019*(1-i)+ -2.3741*Math.log(s)+0*Math.log(s)*Math.log(s)+0*Math.log(s)*(1-i)+0*Math.log(s)*Math.log(s)*(1-i)+ -2.4643*Math.log(h)+ -0.3914*p+ -0.0229*Math.log(d/v)+ -0.3087*m+ -0.2627*m*(1-i)+ -0.2355*g+0*g*i))/(Math.exp(-0.4312)*Math.exp(0*(26.5116+.2019*(1-i)+ -2.3741*Math.log(s)+0*Math.log(s)*Math.log(s)+0*Math.log(s)*(1-i)+0*Math.log(s)*Math.log(s)*(1-i)+ -2.4643*Math.log(h)+ -0.3914*p+ -0.0229*Math.log(d/v)+ -0.3087*m+ -0.2627*m*(1-i)+ -0.2355*g+0*g*i))))))}else if("ascvd"==e){var w=black(),E=bptreatment(),S;i&&!w&&(S=new WhiteMale);!i&&!w&&(S=new WhiteFemale);i&&w&&(S=new BlackMale);!i&&w&&(S=new BlackFemale);y=t*ASCVD10YrRisk(S,s,Math.round(a/.0259),Math.round(f/.0259),o,E,l,u);b=t*ASCVD10YrRisk(S,s,Math.round(d/.0259),Math.round(v/.0259),h,0,0,0)}if("ascvd"==e){$("#divRace").show();$("#divBPTreatment").show();$("#rangeTime").prop("disabled",!0);$("#rangeTime").val(10);$("#rangeTime").hide();adjust("time",$("#rangeTime"),!0)}else{$("#divRace").hide();$("#divBPTreatment").hide();$("#rangeTime").show();$("#rangeTime").prop("disabled",!1)}var x=y-b,T=y*n/100,N=Math.max(0,x-T),C=100-(b+T+N).toFixed(1);$("#score_good").text(C.toFixed(1)+"%");$("#score_bad").text(b.toFixed(1)+"%");$("#score_bad_add").text(N.toFixed(1)+"%");$("#score_benefits").text(T.toFixed(1)+"%");$("#score_nnt").text(T>0?Math.round(100/T):"âˆž");var k=Math.round(b),L=Math.round(T),A=Math.round(N+T)-L,O=100-(k+A+L),M=$("#faces").empty();for(var _=0;_<k;_++)M.prepend(newFace("bad"));for(var _=0;_<A;_++)M.prepend(newFace("badA"));for(var _=0;_<L;_++)M.prepend(newFace("badP"));for(var _=0;_<O;_++)M.prepend(newFace("good"))}function ASCVD10YrRisk(e,t,n,r,i,s,o,u){var a=0;a+=Math.log(t)*e.Age;a+=Math.pow(Math.log(t),2)*e.AgeSquared;a+=Math.log(n)*e.TC;a+=Math.log(t)*Math.log(n)*e.AgexTC;a+=Math.log(r)*e.HDL;a+=Math.log(t)*Math.log(r)*e.AgexHDL;if(s===1){a+=Math.log(i)*e.TreatedBP;a+=Math.log(t)*Math.log(i)*e.AgexTreatedBP}else{a+=Math.log(i)*e.UntreatedBP;a+=Math.log(t)*Math.log(i)*e.AgexUntreatedBP}a+=u*e.Smoker;a+=u*Math.log(t)*e.AgexSmoker;a+=o*e.Diabetes;return 1-Math.pow(e.BaselineSurvival,Math.pow(Math.E,a-e.OverallMean))}function newFace(e){var t=!1;"devicePixelRatio"in window&&(t=window.devicePixelRatio>1);var n=new Image;n.src="imgs/"+e+(t?"@2x":"")+".png";return n}function toggleCholesterolUnit(){_useMMOL=!_useMMOL;var e=38.666666;if(_useMMOL){$("#input").find(".chol_mmol").show();$("#input").find(".chol_mgdl").hide();var t=Math.round($("#totalchol_mgdl").val()/e*10)/10;$("#totalchol_mmol").val(t);adjustValue("chol_mmol",t,!0);var n=Math.round($("#hdlchol_mgdl").val()/e*10)/10;$("#hdlchol_mmol").val(n);adjustValue("hdl_mmol",n,!0)}else{$("#input").find(".chol_mmol").hide();$("#input").find(".chol_mgdl").show();var t=Math.round($("#totalchol_mmol").val()*e/2)*2;$("#totalchol_mgdl").val(t);adjustValue("chol_mgdl",t,!0);var n=Math.round($("#hdlchol_mmol").val()*e/2)*2;$("#hdlchol_mgdl").val(n);adjustValue("hdl_mgdl",n,!0)}}function showImages(e){var t="";"cvd"==e?t='<div><img src="imgs/heart_attack.jpg" />Heart Attacks</div><div><img src="imgs/heart_failure.jpg" />Heart Failure</div><div><img src="imgs/stroke.jpg" />Strokes</div><div><img src="imgs/intermittent.jpg" />Intermittent claudication</div>':"chd"==e?t='<div><img src="imgs/heart_attack.jpg" />Heart Attacks</div><div><img src="imgs/angina.jpg" />Angina</div>':"mi"==e?t='<div><img src="imgs/heart_attack.jpg" />Heart Attacks</div>':"stroke"==e&&(t='<div><img src="imgs/stroke.jpg" />Strokes</div>');$("#disease").html(t)}function convertSliders(){$("input[type=range]").each(function(e,t){$(t).keyup(function(e){var t=$(e.target),n=1*t.attr("min2"),r=1*t.attr("max"),i=t.val();undefined!==n&&i<n&&t.val(n);undefined!==r&&i>r&&t.val(r);CALC()}).css("width","30%").next("b").hide()})}function offlineHint(){alert("This calculator can be used while offline.\n\nOn portable devices you may create a home screen icon for quick access, the calculator will act as if it was an App.")}function offlineStatusChanged(e){var t="Available offline";if("checking"==e.type||"downloading"==e.type)t="Cache "+e.type+"...";$("#cache_status").removeClass("error").text(t)}$(document).ready(function(){CONVERT_SLIDERS&&convertSliders();setFormulaById("cvd");if("applicationCache"in window){window.applicationCache.addEventListener("checking",offlineStatusChanged,!1);window.applicationCache.addEventListener("noupdate",offlineStatusChanged,!1);window.applicationCache.addEventListener("downloading",offlineStatusChanged,!1);window.applicationCache.addEventListener("cached",offlineStatusChanged,!1);window.applicationCache.addEventListener("updateready",offlineStatusChanged,!1);window.applicationCache.addEventListener("obsolete",offlineStatusChanged,!1);window.applicationCache.addEventListener("error",offlineStatusChanged,!1)}});var _useMMOL=!0;Array.prototype.contains=function(e){return this.indexOf(e)>=0};"indexOf"in Array.prototype||(Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return t;return-1});